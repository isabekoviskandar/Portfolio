<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Iskandar Isabekov — Terminal Portfolio</title>

<!-- Tailwind CDN (utility classes) -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  :root{
    --bg:#282a36;
    --panel:#1e1e1e;
    --muted:#b0b0b0;
    --accent:#bd93f9;  /* purple for Ubuntu vibe */
    --error:#ff5555;    /* red */
    --cursor:#50fa7b;   /* green cursor */
  }

  html,body{
    height:100%;
    margin:0;
    background: var(--bg);
    color:#f8f8f2;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Fira Code", "Roboto Mono", monospace;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Terminal container */
  .terminal {
    max-width:1100px;
    margin:40px auto;
    border-radius:4px;
    overflow:hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.5);
    background: var(--panel);
    border: 1px solid #44475a;
  }

  /* Top bar */
  .term-bar {
    display:flex;
    align-items:center;
    gap:12px;
    padding:12px 16px;
    background: #44475a;
    border-bottom:1px solid #6272a4;
  }
  .btn {
    width:12px; height:12px; border-radius:50%;
    box-shadow:0 1px 0 rgba(0,0,0,0.6) inset;
  }
  .btn.red{ background: #ff5555; }
  .btn.yellow{ background: #f1fa8c; }
  .btn.green{ background: #50fa7b; }

  /* Screen area */
  .screen {
    padding:20px;
    min-height:66vh;
    max-height:78vh;
    overflow:auto;
    line-height:1.6;
    font-size:15px;
  }

  .prompt {
    display:flex;
    gap:8px;
    align-items:flex-start;
    margin-bottom:6px;
  }
  .prompt .p1 { color:var(--accent); font-weight:600; }
  .prompt .p2 { color:var(--muted); }

  .input-line {
    display:flex;
    gap:10px;
    align-items:center;
    width:100%;
  }
  .cmd-input {
    background:transparent;
    border: none;
    outline: none;
    color: #f8f8f2;
    width:100%;
    font-family:inherit;
    font-size:15px;
  }

  /* Typed output styles (simplified) */
  .out { white-space:pre-wrap; margin:6px 0; }
  .c-accent { color:var(--accent); }
  .c-muted { color:var(--muted); }
  .c-error { color:var(--error); font-weight:700; }

  /* command chips */
  .chip{ display:inline-block; padding:4px 8px; border-radius:6px; margin:4px 6px 4px 0; font-size:13px; }
  .chip-cmd{ background:rgba(189,147,249,0.08); color:var(--accent); border:1px solid rgba(189,147,249,0.12); }

  /* typing cursor & animation - changed to underline like real terminal */
  .cursor {
    width:10px; height:2px; display:inline-block; margin-left:2px; background:var(--cursor); border-radius:1px;
    animation: blink 1s steps(2,start) infinite;
    position: relative; top: -4px;
  }
  @keyframes blink { 0%,50%{ opacity:1 } 51%,100% { opacity:0 } }

  /* small helpers */
  .small { font-size:13px; color:var(--muted); }
  .kbd { background:rgba(255,255,255,0.03); padding:4px 8px; border-radius:6px; border:1px solid rgba(255,255,255,0.02); font-size:13px; color:#f8f8f2; }

  /* responsive */
  @media (max-width:640px){
    .screen { padding:18px; font-size:14px; }
    .terminal { margin:18px; }
  }

  /* scroll bar aesthetic */
  .screen::-webkit-scrollbar { width:10px; height:10px; }
  .screen::-webkit-scrollbar-thumb { background:#6272a4; border-radius:8px; }

  /* Links styling */
  a { color: var(--accent); text-decoration: none; }
  a:hover { text-decoration: underline; }
</style>
</head>
<body>

<div class="terminal">
  <div class="term-bar">
    <div class="btn red" title="Close"></div>
    <div class="btn yellow" title="Minimize"></div>
    <div class="btn green" title="Maximize"></div>
    <div style="flex:1"></div>
    <div class="small">IskandarIsabekov@portfolio:~</div>
  </div>

  <div id="screen" class="screen" tabindex="0" aria-label="Interactive terminal">
    <!-- All output lines will be injected here -->
  </div>

  <div class="p-4 bg-black/40 text-right small c-muted">Tip: Type <span class="kbd">help</span> to see commands • Navigate history with <span class="kbd">↑</span>/<span class="kbd">↓</span></div>
</div>

<!-- Hidden input to capture keystrokes -->
<input id="hiddenInput" class="cmd-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="position:fixed; bottom:-9999px;">

<script>
/**
 * Terminal Portfolio - Fixed Version
 * Issues fixed:
 * - Async command handling
 * - File system navigation
 * - Tab completion improvements
 * - Game session management
 * - Input handling race conditions
 */

const PROFILE = {
  name: "Isabekov Iskandar",
  title: "Backend Engineer (Laravel & Payment Systems)",
  location: "Tashkent, Uzbekistan",
  phone: "+998 95 020 09 26",
  email: "iskandarisabrkov@gmail.com",
  github: "https://github.com/isabekoviskandar",
  linkedin: "https://www.linkedin.com/in/iskandar-isabekov-60745229b",
  experiences: [
    {
      role: "Backend Developer",
      company: "Elaro.uz E-commerce Platform",
      period: "March 2025 – June 2025",
      bullets: [
        "Built scalable Laravel e-commerce platform using DDD patterns",
        "Integrated Payme, Click, Uzum, OCTO payment gateways",
        "Developed modular architecture for rapid feature deployment",
        "Optimized system for high-concurrency purchases"
      ]
    },
    {
      role: "Backend Developer",
      company: "ParkMe Payment Parking System",
      period: "2025",
      bullets: [
        "Led payment integration with Click & OctoBank",
        "Designed PostgreSQL schema for time-based billing & transactions",
        "Built RESTful APIs with authentication & CI/CD pipelines"
      ]
    },
    {
      role: "Backend Developer Intern",
      company: "Softex LLC (Akam.uz EdTech Platform)",
      period: "July – August 2025",
      bullets: [
        "Contributed to migration from Yii2 → Laravel",
        "Refactored legacy code into modern Laravel architecture",
        "Assisted in feature development & large-scale bug fixes"
      ]
    }
  ],
  skills: {
    Backend: ["PHP","Laravel","REST APIs","MySQL","PostgreSQL","Docker","AWS EC2"],
    Payments: ["Payme","Click","Uzum","OCTO","Paynet","OctoBank"],
    Architecture: ["DDD","MVC","Database Optimization","Concurrency"],
    Frontend: ["HTML","CSS","JavaScript","Blade","Livewire"],
    Tools: ["Git","CI/CD","PHPStan","PHP CS Fixer"],
  },
  education: [
    {
      school: "Najot Ta'lim Bootcamps (Tashkent)",
      details: [
        "Backend Development Bootcamp — Laravel, REST APIs, Docker, Agile",
        "Foundation Bootcamp — C/Python fundamentals, Git, Algorithms"
      ]
    }
  ],
  languages: ["Uzbek (Native)","English (Professional)","Russian (Conversational)"],
  interests: ["Algorithms","Mentoring","Open-source contributions"]
};

const screen = document.getElementById('screen');
const hiddenInput = document.getElementById('hiddenInput');

let history = [];
let historyIndex = -1;
let isProcessing = false;
let autocompleteList = ["help","about","experience","skills","education","contact","clear","home","games","guess-number","typing-challenge","whoami","ls","pwd","echo","projects","languages","interests","cd","cat","mkdir","neofetch","joke","exit","sudo","resume","rm"];

// Virtual File System - Fixed structure
let currentPath = "~";
const VFS = {
  "~": {
    type: "dir",
    contents: {
      "resume.txt": { 
        type: "file", 
        content: `${PROFILE.name}
Backend Engineer (Laravel & Payment Systems)

CONTACT:
Email: ${PROFILE.email}
Phone: ${PROFILE.phone}
Location: ${PROFILE.location}
GitHub: ${PROFILE.github}
LinkedIn: ${PROFILE.linkedin}

EXPERIENCE:
• Backend Developer at Elaro.uz E-commerce Platform (March 2025 – June 2025)
  - Built scalable Laravel e-commerce platform using DDD patterns
  - Integrated Payme, Click, Uzum, OCTO payment gateways
  - Developed modular architecture for rapid feature deployment

• Backend Developer at ParkMe Payment Parking System (2025)
  - Led payment integration with Click & OctoBank
  - Designed PostgreSQL schema for time-based billing & transactions

• Backend Developer Intern at Softex LLC (July – August 2025)
  - Contributed to migration from Yii2 → Laravel
  - Refactored legacy code into modern Laravel architecture

SKILLS:
Backend: ${PROFILE.skills.Backend.join(", ")}
Payments: ${PROFILE.skills.Payments.join(", ")}
Architecture: ${PROFILE.skills.Architecture.join(", ")}
Frontend: ${PROFILE.skills.Frontend.join(", ")}
Tools: ${PROFILE.skills.Tools.join(", ")}

EDUCATION:
${PROFILE.education[0].school}
${PROFILE.education[0].details.join("\n")}

LANGUAGES: ${PROFILE.languages.join(", ")}
INTERESTS: ${PROFILE.interests.join(", ")}` 
      },
      "projects": { 
        type: "dir", 
        contents: {
          "elaro.txt": { 
            type: "file", 
            content: `Elaro E-commerce Platform

Role: Backend Developer
Period: March 2025 – June 2025
Technologies: Laravel, PHP, MySQL, Docker, AWS EC2

Key Achievements:
• Built scalable e-commerce platform using Domain Driven Design (DDD) patterns
• Integrated multiple Uzbek payment gateways (Payme, Click, Uzum, OCTO)
• Developed modular architecture for rapid feature deployment
• Optimized system for high-concurrency purchases
• Implemented robust error handling and logging systems

Technical Details:
- Microservices architecture with Laravel
- Payment gateway abstractions for easy integration
- Database optimization for high-traffic scenarios
- CI/CD pipeline setup with automated testing` 
          },
          "parkme.txt": { 
            type: "file", 
            content: `ParkMe Payment Parking System

Role: Backend Developer
Period: 2025
Technologies: Laravel, PostgreSQL, REST APIs

Key Achievements:
• Led payment integration with Click & OctoBank payment systems
• Designed PostgreSQL schema for time-based billing & transactions
• Built RESTful APIs with robust authentication systems
• Implemented CI/CD pipelines for automated deployment

Technical Features:
- Time-based parking billing system
- Real-time payment processing
- Transaction logging and reconciliation
- Mobile-friendly API endpoints
- Automated billing calculations` 
          },
          "akam.txt": { 
            type: "file", 
            content: `Akam EdTech Platform (Softex LLC)

Role: Backend Developer Intern
Period: July – August 2025
Technologies: Laravel, Yii2, MySQL, PHP

Key Contributions:
• Contributed to large-scale migration from Yii2 → Laravel
• Refactored legacy code into modern Laravel architecture
• Assisted in feature development & large-scale bug fixes
• Improved code quality and performance

Migration Details:
- Database schema modernization
- API endpoint restructuring
- Authentication system upgrade
- Performance optimization
- Code quality improvements with PHPStan` 
          }
        }
      },
      "skills.txt": { 
        type: "file", 
        content: Object.entries(PROFILE.skills).map(([k, v]) => `${k}: ${v.join(", ")}`).join("\n") 
      }
    }
  }
};

// Initialize focus
setTimeout(()=> hiddenInput.focus(), 50);

function sanitize(input){
  if (typeof input !== 'string') return '';
  return input.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function appendLine(html, cls = ''){
  const line = document.createElement('div');
  line.className = (cls ? cls + ' ' : '') + 'out';
  line.innerHTML = html || '';
  screen.appendChild(line);
  screen.scrollTop = screen.scrollHeight;
  return line;
}

function getCurrentDir(path = currentPath) {
  if (path === "~") return VFS["~"];
  
  let dir = VFS["~"];
  const parts = path.split("/").filter(p => p && p !== "~");
  
  for (let part of parts) {
    if (part === "..") {
      // Handle going up - for simplicity, just go back to root
      continue;
    }
    if (dir && dir.contents && dir.contents[part] && dir.contents[part].type === "dir") {
      dir = dir.contents[part];
    } else {
      return null;
    }
  }
  return dir;
}

function resolvePath(path) {
  if (!path) return currentPath;
  
  if (path === "~" || path === "/") return "~";
  if (path === "..") {
    if (currentPath === "~") return "~";
    const parts = currentPath.split("/").filter(p => p);
    parts.pop();
    return parts.length ? parts.join("/") : "~";
  }
  if (path === ".") return currentPath;
  
  // Handle absolute paths
  if (path.startsWith("~/")) {
    return path.slice(2);
  }
  
  // Handle relative paths
  if (currentPath === "~") {
    return path;
  } else {
    return currentPath + "/" + path;
  }
}

function promptLine(){
  const p = document.createElement('div');
  p.className = 'prompt';
  const displayPath = currentPath === "~" ? "~" : "~/" + currentPath;
  p.innerHTML = `<div class="p1 c-accent">${sanitize(PROFILE.name)}</div><div class="p2 small">@portfolio:${sanitize(displayPath)}$</div>`;
  screen.appendChild(p);
  screen.scrollTop = screen.scrollHeight;
  return p;
}

async function typeOut(targetElement, text, opts = {}){
  const speed = opts.speed || 18;
  return new Promise(resolve=>{
    let i = 0;
    function step(){
      if(i >= text.length){ resolve(); return; }
      const ch = text[i++];
      targetElement.innerHTML += sanitize(ch);
      screen.scrollTop = screen.scrollHeight;
      setTimeout(step, speed + (Math.random()*3));
    }
    step();
  });
}

function span(text, cls){ 
  return `<span class="${cls}">${sanitize(text)}</span>`; 
}

const JOKES = [
  "Why do programmers prefer dark mode? Because light attracts bugs.",
  "How many programmers does it take to change a light bulb? None, that's a hardware problem.",
  "Why did the programmer quit his job? Because he didn't get arrays.",
  "Why do PHP developers love arrays? Because they're always key to success!",
  "What's a Laravel developer's favorite song? 'Migrate' by The Eloquent Models."
];

const COMMANDS = {
  help: async () => {
    appendLine(span("Available commands:","c-accent") + " (type and press Enter)");
    appendLine("");
    const categories = [
      { name: "Personal Info", commands: ["about", "experience", "skills", "projects", "education", "contact", "resume"] },
      { name: "System", commands: ["ls", "pwd", "cd", "cat", "mkdir", "rm", "whoami", "neofetch"] },
      { name: "Utilities", commands: ["echo", "clear", "home", "joke", "exit", "sudo"] },
      { name: "Interactive", commands: ["games", "guess-number", "typing-challenge"] }
    ];
    
    categories.forEach(cat => {
      appendLine(span(cat.name + ":", "c-accent"));
      appendLine(cat.commands.map(c => `<span class="chip chip-cmd">${c}</span>`).join(' '));
      appendLine("");
    });
    
    appendLine(span("Tips:", "c-accent") + " Use " + span("↑/↓", "c-accent") + " to navigate history, " + span("Tab", "c-accent") + " for autocomplete.");
  },

  about: async () => {
    const lines = [
      span(PROFILE.name, "c-accent") + " - " + span(PROFILE.title, "c-accent"),
      "",
      span("Location:", "c-accent") + " " + span(PROFILE.location, "c-muted"),
      span("Phone:", "c-accent") + " " + span(PROFILE.phone, "c-muted"),
      span("Email:", "c-accent") + " " + span(PROFILE.email, "c-accent"),
      "",
      span("GitHub:", "c-accent") + " " + `<a href="${PROFILE.github}" target="_blank">${PROFILE.github}</a>`,
      span("LinkedIn:", "c-accent") + " " + `<a href="${PROFILE.linkedin}" target="_blank">${PROFILE.linkedin}</a>`,
      "",
      span("Passionate backend engineer specializing in Laravel and payment systems.", "c-muted")
    ];
    lines.forEach(l => appendLine(l));
  },

  experience: async () => {
    appendLine(span("Professional Experience", "c-accent"));
    appendLine("");
    PROFILE.experiences.forEach((e, index) => {
      appendLine(span(`${index + 1}. ${e.role}`, "c-accent") + " " + span("—", "c-muted") + " " + span(e.company, "c-accent"));
      appendLine("   " + span(e.period, "c-muted"));
      appendLine("");
      e.bullets.forEach(bullet => {
        appendLine(`   ${span("•", "c-accent")} ${span(bullet, "c-muted")}`);
      });
      appendLine("");
    });
  },

  skills: async () => {
    appendLine(span("Technical Skills", "c-accent") + " — grouped by domain");
    appendLine("");
    Object.entries(PROFILE.skills).forEach(([category, skills]) => {
      appendLine(span(category + ":", "c-accent") + " " + skills.map(s => span(s, "c-accent")).join(", "));
    });
  },

  education: async () => {
    appendLine(span("Education & Training", "c-accent"));
    appendLine("");
    PROFILE.education.forEach(ed => {
      appendLine(span(ed.school, "c-accent"));
      ed.details.forEach(detail => appendLine("  " + span("•", "c-accent") + " " + span(detail, "c-muted")));
      appendLine("");
    });
  },

  contact: async () => {
    appendLine(span("Contact Information", "c-accent"));
    appendLine("");
    const contactInfo = [
      ["Email", PROFILE.email, PROFILE.email],
      ["Phone", PROFILE.phone, `tel:${PROFILE.phone}`],
      ["GitHub", PROFILE.github, PROFILE.github],
      ["LinkedIn", PROFILE.linkedin, PROFILE.linkedin]
    ];
    
    contactInfo.forEach(([label, value, link]) => {
      if (link.startsWith('http')) {
        appendLine(span(label + ":", "c-accent") + " " + `<a href="${link}" target="_blank">${value}</a>`);
      } else {
        appendLine(span(label + ":", "c-accent") + " " + span(value, "c-muted"));
      }
    });
    
    appendLine("");
    appendLine(span("Feel free to reach out for opportunities or collaboration!", "c-muted"));
  },

  clear: async () => {
    screen.innerHTML = "";
  },

  home: async () => {
    await COMMANDS.clear();
    await appendIntro();
  },

  whoami: async () => {
    appendLine(span(PROFILE.name, "c-accent") + " — " + span(PROFILE.title, "c-accent"));
  },

  projects: async () => {
    appendLine(span("Key Projects", "c-accent"));
    appendLine("");
    
    const projects = [
      {
        name: "Elaro E-commerce Platform",
        tech: "Laravel, PHP, MySQL, Docker",
        desc: "Scalable e-commerce platform with DDD patterns and payment gateway integrations (Payme, Click, Uzum, OCTO).",
        file: "projects/elaro.txt"
      },
      {
        name: "ParkMe Payment System",
        tech: "Laravel, PostgreSQL, REST APIs",
        desc: "Time-based parking & payments with PostgreSQL billing schema and payment integrations.",
        file: "projects/parkme.txt"
      },
      {
        name: "Akam EdTech Migration",
        tech: "Laravel, Yii2, MySQL",
        desc: "Large-scale EdTech platform migration from Yii2 to Laravel with performance improvements.",
        file: "projects/akam.txt"
      }
    ];
    
    projects.forEach((project, index) => {
      appendLine(span(`${index + 1}. ${project.name}`, "c-accent") + " " + span(`(${project.tech})`, "c-muted"));
      appendLine("   " + span(project.desc, "c-muted"));
      appendLine("   " + span(`Use 'cat ${project.file}' for detailed information`, "c-accent"));
      appendLine("");
    });
  },

  languages: async () => {
    appendLine(span("Languages:", "c-accent") + " " + PROFILE.languages.map(l => span(l, "c-muted")).join(", "));
  },

  interests: async () => {
    appendLine(span("Interests:", "c-accent") + " " + PROFILE.interests.map(i => span(i, "c-muted")).join(", "));
  },

  ls: async (args) => {
    const targetPath = args.length ? resolvePath(args[0]) : currentPath;
    const dir = getCurrentDir(targetPath);
    
    if (!dir || dir.type !== "dir") {
      appendLine(span(`ls: cannot access '${args[0] || '.'}': No such file or directory`, "c-error"));
      return;
    }
    
    const items = Object.entries(dir.contents);
    if (items.length === 0) {
      appendLine(span("(empty directory)", "c-muted"));
      return;
    }
    
    items.forEach(([name, item]) => {
      const color = item.type === "dir" ? "c-accent" : "c-muted";
      const suffix = item.type === "dir" ? "/" : "";
      appendLine(span(name + suffix, color));
    });
  },

  pwd: async () => {
    const displayPath = currentPath === "~" ? "/home/portfolio" : "/home/portfolio/" + currentPath.replace("~", "").replace(/^\//, "");
    appendLine(displayPath);
  },

  echo: async (args) => {
    appendLine(args.join(" "));
  },

  cd: async (args) => {
    if (!args.length) {
      currentPath = "~";
      return;
    }
    
    const newPath = resolvePath(args[0]);
    const dir = getCurrentDir(newPath);
    
    if (dir && dir.type === "dir") {
      currentPath = newPath;
    } else {
      appendLine(span(`cd: no such file or directory: ${args[0]}`, "c-error"));
    }
  },

  cat: async (args) => {
    if (!args.length) {
      appendLine(span("cat: missing file operand", "c-error"));
      return;
    }
    
    const filePath = args[0];
    let resolvedPath, fileName;
    
    if (filePath.includes("/")) {
      const parts = filePath.split("/");
      fileName = parts.pop();
      const dirPath = parts.join("/");
      resolvedPath = resolvePath(dirPath);
    } else {
      fileName = filePath;
      resolvedPath = currentPath;
    }
    
    const dir = getCurrentDir(resolvedPath);
    
    if (dir && dir.contents && dir.contents[fileName]) {
      const file = dir.contents[fileName];
      if (file.type === "file") {
        appendLine(file.content);
      } else {
        appendLine(span(`cat: ${fileName}: Is a directory`, "c-error"));
      }
    } else {
      appendLine(span(`cat: ${fileName}: No such file or directory`, "c-error"));
    }
  },

  mkdir: async (args) => {
    if (!args.length) {
      appendLine(span("mkdir: missing operand", "c-error"));
      return;
    }
    appendLine(span("mkdir: cannot create directory: Read-only file system", "c-error"));
  },

  rm: async (args) => {
    if (!args.length) {
      appendLine(span("rm: missing operand", "c-error"));
      return;
    }
    appendLine(span("rm: cannot remove: Read-only file system", "c-error"));
  },

  neofetch: async () => {
    const asciiArt = [
      "       _,met$$$$$gg.",
      "    ,g$$$$$$$$$$$$$$$P.",
      "  ,g$$P\"     \"\"\"Y$$.\".",
      " ,$$P'              `$$$.",
      "',$$P       ,ggs.     `$$b:",
      "`d$$'     ,$P\"'   .    $$$",
      " $$P      d$'     ,    $$P",
      " $$:      $.      -    ,d$$'",
      " $$;      Y$b._   _,d$P'",
      " Y$$.    `.`\"Y$$$$P\"'",
      " `$$b      \"-.__",
      "  `Y$$",
      "   `Y$$.",
      "     `$$b.",
      "       `Y$$b.",
      "          `\"Y$b._",
      "              `\"\"\""
    ].join('\n');

    appendLine(asciiArt);
    appendLine("");
    
    const info = [
      ["User", PROFILE.name],
      ["Hostname", "portfolio"],
      ["Title", PROFILE.title],
      ["Location", PROFILE.location],
      ["Shell", "/bin/terminal-portfolio"],
      ["Languages", PROFILE.languages.join(", ")],
      ["Skills", Object.keys(PROFILE.skills).join(", ")],
      ["Uptime", "Always learning"]
    ];
    
    info.forEach(([key, value]) => {
      appendLine(span(key + ":", "c-accent") + " " + span(value, "c-muted"));
    });
  },

  joke: async () => {
    const joke = JOKES[Math.floor(Math.random() * JOKES.length)];
    appendLine(span(joke, "c-accent"));
  },

  exit: async () => {
    appendLine(span("Thanks for visiting my portfolio!", "c-accent"));
    appendLine(span("Session ended. Refresh page to restart.", "c-muted"));
    isProcessing = true;
    hiddenInput.style.display = 'none';
  },

  sudo: async (args) => {
    if (args.length === 0) {
      appendLine(span("[sudo] password for " + PROFILE.name + ":", "c-muted"));
      appendLine(span("Sorry, try again.", "c-error"));
      return;
    }
    appendLine(span(`${PROFILE.name} is not in the sudoers file. This incident will be reported.`, "c-error"));
  },

  resume: async () => {
    await COMMANDS.cat(["resume.txt"]);
  },

  games: async () => {
    appendLine(span("🎮 Games Suite", "c-accent"));
    appendLine("");
    appendLine("Available mini-games:");
    appendLine(`  ${span("guess-number", "c-accent")}     → Classic number guessing game (1-100)`);
    appendLine(`  ${span("typing-challenge", "c-accent")}  → Test your typing speed and accuracy`);
    appendLine("");
    appendLine(span("To play:", "c-accent") + " type the game name and press Enter");
    appendLine(span("Example:", "c-muted") + " " + span("guess-number", "c-accent"));
  },

  "guess-number": async () => {
    await startGuessNumber();
  },

  "typing-challenge": async () => {
    await startTypingChallenge();
  }
};

function autocomplete(input) {
  const tokens = input.trim().split(/\s+/);
  const lastToken = tokens[tokens.length - 1].toLowerCase();
  const cmd = tokens[0] ? tokens[0].toLowerCase() : "";

  if (tokens.length === 1) {
    // Complete commands
    return autocompleteList.filter(x => x.startsWith(lastToken));
  } else if (["cd", "ls", "cat", "rm"].includes(cmd)) {
    // Complete paths/files
    const pathPrefix = lastToken;
    let dirPath = "";
    let prefix = pathPrefix;
    
    if (pathPrefix.includes("/")) {
      const lastSlash = pathPrefix.lastIndexOf("/");
      dirPath = pathPrefix.slice(0, lastSlash + 1);
      prefix = pathPrefix.slice(lastSlash + 1);
    }
    
    const resolvedDirPath = resolvePath(dirPath || ".");
    const dir = getCurrentDir(resolvedDirPath);
    
    if (dir && dir.contents) {
      const matches = Object.keys(dir.contents).filter(name => 
        name.toLowerCase().startsWith(prefix.toLowerCase())
      );
      return matches.map(m => {
        const isDir = dir.contents[m].type === "dir";
        return dirPath + m + (isDir ? "/" : "");
      });
    }
  }
  return [];
}

async function startGuessNumber(){
  if(isProcessing) return;
  isProcessing = true;
  
  const min = 1, max = 100;
  const target = Math.floor(Math.random() * (max - min + 1)) + min;
  let attempts = 0;
  
  appendLine(span("🎯 Guess the Number Game", "c-accent"));
  appendLine(span("I'm thinking of a number between 1 and 100.", "c-muted"));
  appendLine(span("Type a number or 'quit' to exit.", "c-muted"));
  appendLine("");

  const handler = async (tokens) => {
    const input = tokens.join(" ").trim().toLowerCase();
    
    if(input === 'quit' || input === 'exit'){
      appendLine(span("Thanks for playing! The number was " + target + ".", "c-accent"));
      teardown();
      return;
    }
    
    const guess = Number(input);
    if(Number.isNaN(guess) || guess < min || guess > max){
      appendLine(span("Please enter a valid number between 1 and 100, or 'quit' to exit.", "c-error"));
      return;
    }
    
    attempts++;
    
    if(guess === target){
      appendLine(span(`🎉 Congratulations! You got it in ${attempts} attempt${attempts === 1 ? '' : 's'}!`, "c-accent"));
      appendLine(span("Returning to normal prompt...", "c-muted"));
      teardown();
      return;
    }
    
    const hint = guess < target ? "Too low! 📈" : "Too high! 📉";
    appendLine(span(`${hint} Try again (attempt ${attempts}).`, "c-accent"));
  };

  installTemporaryHandler(handler, () => { isProcessing = false; });
}

async function startTypingChallenge(){
  if(isProcessing) return;
  isProcessing = true;
  
  const sentences = [
    "Backend engineer building reliable systems, payments, and APIs.",
    "Laravel framework enables rapid development of robust web applications.",
    "Payment gateways require careful integration and thorough testing.",
    "Clean code is not written by following rules but by following principles."
  ];
  
  const sentence = sentences[Math.floor(Math.random() * sentences.length)];
  let gameStarted = false;
  let startTime = 0;
  
  appendLine(span("⌨️  Typing Challenge", "c-accent"));
  appendLine(span("Type the following sentence as quickly and accurately as possible:", "c-muted"));
  appendLine("");
  appendLine(span(`"${sentence}"`, "c-accent"));
  appendLine("");
  appendLine(span("Type 'start' when ready, or 'quit' to exit.", "c-muted"));

  const handler = async (tokens) => {
    const input = tokens.join(" ").trim();
    
    if(!gameStarted){
      if(input.toLowerCase() === "start"){
        gameStarted = true;
        startTime = performance.now();
        appendLine(span("🚀 Go! Type the sentence above and press Enter:", "c-accent"));
        return;
      }
      if(input.toLowerCase() === "quit" || input.toLowerCase() === "exit"){
        appendLine(span("Challenge cancelled.", "c-muted"));
        teardown();
        return;
      }
      appendLine(span("Type 'start' to begin or 'quit' to cancel.", "c-accent"));
      return;
    }
    
    // Game is started, process typing result
    const endTime = performance.now();
    const timeTaken = (endTime - startTime) / 1000;
    
    // Calculate accuracy
    let correctChars = 0;
    const minLength = Math.min(input.length, sentence.length);
    
    for(let i = 0; i < minLength; i++){
      if(input[i] === sentence[i]) correctChars++;
    }
    
    // Penalize for length differences
    const lengthPenalty = Math.abs(input.length - sentence.length);
    const totalAccuracy = Math.max(0, Math.round(((correctChars - lengthPenalty) / sentence.length) * 100));
    
    // Calculate WPM
    const words = sentence.split(/\s+/).length;
    const wpm = Math.round((words / timeTaken) * 60);
    
    appendLine("");
    appendLine(span("📊 Results:", "c-accent"));
    appendLine(span(`Time: ${timeTaken.toFixed(2)} seconds`, "c-muted"));
    appendLine(span(`Speed: ${Math.max(0, wpm)} WPM`, "c-accent"));
    appendLine(span(`Accuracy: ${Math.max(0, totalAccuracy)}%`, "c-accent"));
    
    if(totalAccuracy === 100){
      appendLine(span("🎯 Perfect! No errors detected!", "c-accent"));
    } else if(totalAccuracy >= 90){
      appendLine(span("🌟 Excellent typing!", "c-accent"));
    } else if(totalAccuracy >= 70){
      appendLine(span("👍 Good job!", "c-accent"));
    } else {
      appendLine(span("💪 Keep practicing!", "c-accent"));
    }
    
    appendLine("");
    appendLine(span("Returning to normal prompt...", "c-muted"));
    teardown();
  };

  installTemporaryHandler(handler, () => { isProcessing = false; });
}

let tempHandler = null;

function installTemporaryHandler(handlerFn, onDone){
  tempHandler = { fn: handlerFn, onDone };
}

function teardown(){
  if(tempHandler && tempHandler.onDone) { 
    tempHandler.onDone(); 
  }
  tempHandler = null;
  isProcessing = false;
  
  // Create new prompt
  setTimeout(() => {
    if (!isProcessing) {
      typedSpan = createPromptInteractive();
      hiddenInput.value = "";
      hiddenInput.focus();
    }
  }, 100);
}

async function handleUserCommand(line){
  const raw = line.trim();
  if(!raw) return;

  // Add to history
  history.push(raw);
  historyIndex = history.length;

  const tokens = raw.split(/\s+/);
  const cmd = tokens[0].toLowerCase();

  // Handle temporary handlers (games)
  if(tempHandler){
    try {
      await tempHandler.fn(tokens);
    } catch(error) {
      appendLine(span("Game error occurred.", "c-error"));
      teardown();
    }
    return;
  }

  // Handle normal commands
  if(COMMANDS[cmd]){
    try {
      await COMMANDS[cmd](tokens.slice(1));
    } catch(error) {
      appendLine(span(`Error executing command: ${cmd}`, "c-error"));
      console.error('Command error:', error);
    }
  } else {
    appendLine(span(`Command not found: ${cmd}`, "c-error"));
    appendLine(span("Type 'help' to see available commands.", "c-muted"));
  }
}

function createPromptInteractive(prefill = ""){
  if (isProcessing) return null;
  
  const p = promptLine();
  const inputLine = document.createElement('div');
  inputLine.className = 'input-line';
  inputLine.innerHTML = `<div style="min-width:8px"></div><div style="flex:1"><span class="typed" aria-live="polite">${sanitize(prefill)}</span><span class="cursor" aria-hidden="true"></span></div>`;
  p.appendChild(inputLine);
  screen.scrollTop = screen.scrollHeight;
  return p.querySelector('.typed');
}

let typedSpan = createPromptInteractive();

// Input handling
hiddenInput.value = "";

hiddenInput.addEventListener('keydown', async (ev) => {
  if (isProcessing && ev.key !== 'Enter') return;
  
  if(ev.key === "Enter"){
    ev.preventDefault();
    const cmd = hiddenInput.value;
    
    // Remove cursor and finalize current line
    const cursorEl = typedSpan?.parentElement?.querySelector('.cursor');
    if (cursorEl) cursorEl.remove();
    if (typedSpan) typedSpan.textContent = cmd;
    
    appendLine(""); // Add spacing
    
    try {
      await handleUserCommand(cmd);
    } catch(e){
      appendLine(span("Command execution error.", "c-error"));
      console.error('Execution error:', e);
    }
    
    // Create new prompt if not in a game
    if (!isProcessing) {
      typedSpan = createPromptInteractive();
      hiddenInput.value = "";
    }
    return;
  }

  if(ev.key === "Tab"){
    ev.preventDefault();
    const currentValue = hiddenInput.value;
    const matches = autocomplete(currentValue);
    
    if(matches.length === 1){
      // Single match - complete it
      const tokens = currentValue.split(/\s+/);
      const lastToken = tokens[tokens.length - 1];
      const newValue = currentValue.slice(0, currentValue.length - lastToken.length) + matches[0];
      hiddenInput.value = newValue;
      if (typedSpan) typedSpan.textContent = newValue;
    } else if(matches.length > 1){
      // Multiple matches - show them
      appendLine("");
      appendLine("Possible completions:");
      appendLine(matches.map(m => span(m, "c-accent")).join("  "));
      
      // Find common prefix
      const commonPrefix = matches.reduce((prefix, match) => {
        let i = 0;
        while (i < prefix.length && i < match.length && prefix[i] === match[i]) i++;
        return prefix.slice(0, i);
      });
      
      const tokens = currentValue.split(/\s+/);
      const lastToken = tokens[tokens.length - 1];
      
      if (commonPrefix.length > lastToken.length) {
        const newValue = currentValue.slice(0, currentValue.length - lastToken.length) + commonPrefix;
        hiddenInput.value = newValue;
        if (typedSpan) typedSpan.textContent = newValue;
      }
      
      // Create new prompt
      typedSpan = createPromptInteractive(hiddenInput.value);
    }
    return;
  }

  if(ev.key === "ArrowUp" || ev.key === "ArrowDown"){
    ev.preventDefault();
    
    if(ev.key === "ArrowUp"){
      if(historyIndex > 0) {
        historyIndex--;
      } else if(historyIndex === -1 && history.length > 0) {
        historyIndex = history.length - 1;
      }
    } else { // ArrowDown
      if(historyIndex < history.length - 1) {
        historyIndex++;
      } else { 
        historyIndex = history.length; 
        hiddenInput.value = ""; 
        if (typedSpan) typedSpan.textContent = "";
        return; 
      }
    }
    
    if(historyIndex >= 0 && historyIndex < history.length){
      hiddenInput.value = history[historyIndex];
      if (typedSpan) typedSpan.textContent = hiddenInput.value;
    }
    return;
  }

  if(ev.key === 'c' && (ev.ctrlKey || ev.metaKey)){
    ev.preventDefault();
    
    if(tempHandler){
      appendLine(span("^C", "c-error"));
      appendLine(span("Game cancelled.", "c-muted"));
      teardown();
    } else {
      appendLine(span("^C", "c-error"));
      typedSpan = createPromptInteractive();
    }
    hiddenInput.value = "";
    return;
  }

  // Update display after other keys
  setTimeout(() => {
    if (typedSpan) typedSpan.textContent = hiddenInput.value;
  }, 0);
});

// Handle paste events
hiddenInput.addEventListener('paste', (ev) => {
  setTimeout(() => {
    if (typedSpan) typedSpan.textContent = hiddenInput.value;
  }, 10);
});

// Focus management
window.addEventListener('keydown', (ev) => {
  if(document.activeElement !== hiddenInput && !isProcessing){
    hiddenInput.focus();
  }
});

screen.addEventListener('click', () => {
  if (!isProcessing) hiddenInput.focus();
});

// Introduction function
async function appendIntro(){
  appendLine(span("Welcome to the interactive terminal portfolio", "c-accent"));
  appendLine("");
  appendLine("This terminal simulates a real development environment. Available commands:");
  appendLine(span("help", "c-accent") + "  " + span("about", "c-accent") + "  " + span("experience", "c-accent") + "  " + span("skills", "c-accent") + "  " + span("projects", "c-accent"));
  appendLine("");
  appendLine(span("Navigation:", "c-muted") + " Use " + span("ls", "c-accent") + " to list files, " + span("cd", "c-accent") + " to change directories, " + span("cat", "c-accent") + " to read files");
  appendLine(span("Fun stuff:", "c-muted") + " Try " + span("neofetch", "c-accent") + ", " + span("games", "c-accent") + ", or " + span("joke", "c-accent"));
  appendLine("");
  appendLine(span("Type 'help' for a complete list of commands.", "c-accent"));
}

// Initialize terminal
(async function(){
  screen.innerHTML = "";
  
  // ASCII header with typing effect
  const header = appendLine("", "");
  await typeOut(header, "┌─[ portfolio :: terminal ]─┐\n", { speed: 8 });
  
  const subtitle = appendLine("", "");
  await typeOut(subtitle, `| user: ${PROFILE.name}\n| role: ${PROFILE.title}\n`, { speed: 6 });
  
  const timestamp = appendLine("", "");
  const now = new Date();
  await typeOut(timestamp, `| session: ${now.toLocaleString()}\n`, { speed: 6 });
  
  appendLine("└" + "─".repeat(30) + "┘\n", "c-muted");
  
  // Brief pause before intro
  await new Promise(r => setTimeout(r, 300));
  
  await appendIntro();
  
  // Focus input
  hiddenInput.focus();
})();

// Prevent tab navigation away from input
screen.addEventListener('keydown', (e) => {
  if(e.key === 'Tab') { 
    e.preventDefault(); 
    if (!isProcessing) hiddenInput.focus(); 
  }
});

// Export for debugging
window.TERMINAL = {
  appendLine, 
  appendIntro, 
  typeOut,
  PROFILE,
  VFS,
  getCurrentDir,
  resolvePath
};

</script>
</body>
</html>